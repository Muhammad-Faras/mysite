{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="flex justify-center items-center px-4 mt-32">
    <div class="bg-white p-6 rounded-lg shadow-md sm:w-full md:w-3/4 lg:w-1/2">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                        <p class="w-full bg-indigo-600 text-white py-2 px-4 text-center">{{ message }}</p>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <!-- Edit Options for Author -->
        {% if request.user == post.author %}
            <div class="flex justify-end space-x-2 mb-4">
                <a class="px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-md hover:bg-gradient-to-l transition duration-300" href="{% url 'posts:update-post' post.id %}">Update</a>
                <a class="px-6 py-2 bg-gradient-to-r from-red-600 to-red-500 text-white rounded-md hover:bg-gradient-to-l transition duration-300" href="{% url 'posts:delete-post' post.id %}">Delete</a>
            </div>
        {% endif %}
        <hr class="mb-4">

        <!-- Post Section -->
        <div class="mb-6">
            <div class="flex items-center mb-4">
                <div class="w-12 h-12 bg-gray-100 rounded-full border border-gray-300 overflow-hidden">
                    <a href="{% url 'accounts:other_userprofile' post.author.id %}">
                        {% if post.author.profile.profile_img %}
                            <img src="{{ post.author.profile.profile_img.url }}" alt="{{ post.author.username }}" class="w-full h-full object-cover">
                        {% else %}
                            <i class="fa-solid fa-user text-gray-400 text-2xl"></i>
                        {% endif %}
                    </a>
                </div>
                <div class="ml-4">
                    <a class="text-lg font-semibold hover:underline hover:text-blue-600" href="{% url 'accounts:other_userprofile' post.author.id %}">{{ post.author.get_full_name }}</a>
                    <p class="text-gray-500 text-sm">{{ post.author.profile.skill|default:"Student" }}</p>
                </div>
                <p class="ml-auto text-gray-500 text-sm">{{ post.created_at }}</p>
            </div>
            <h2 class="text-2xl font-bold mb-2">{{ post.title }}</h2>
            {% if post.description %}
                <p class="text-gray-700 mb-4">{{ post.description }}</p>
            {% endif %}
            {% if post.post_img %}
                <img class="rounded-lg w-full h-96 object-cover mb-4" src="{{ post.post_img.url }}" alt="Post Image">
            {% endif %}
            <div class="flex justify-between items-center mb-4">
                <p class="text-gray-600">{{ post.number_of_likes }} likes</p>
                <p class="text-gray-600">20 comments</p>
            </div>
            <hr class="mb-4">

            <!-- Like Form -->
            <div class="mb-4">
                <form action="{% url 'posts:like_post' pk=post.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="flex items-center space-x-2 text-blue-600 hover:text-blue-700">
                        {% if request.user in post.likes.all %}
                            <i class="fa-solid fa-thumbs-up text-2xl"></i><span>Dislike</span>
                        {% else %}
                            <i class="fa-regular fa-thumbs-up text-2xl"></i><span>Like</span>
                        {% endif %}
                    </button>
                </form>
            </div>
            <hr class="mb-4">

            <!-- Comment Form -->
            <form class="flex flex-col md:flex-row items-center md:space-x-4 space-y-4 md:space-y-0" action="{% url 'posts:detail-post' post.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <div class="flex-grow w-full">
                    {{ comment_form.comment_body }}
                </div>
                <button class="px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-lg hover:bg-gradient-to-l transition duration-300 w-full md:w-auto" type="submit">Comment</button>
            </form>
            <hr class="my-4">

            <!-- Comments Section -->
            <div class="space-y-4">
                {% for comment in comments %}
                    {% if comment.post.id == post.id %}
                        <div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm font-semibold">{{ comment.author.username }}</p>
                                <p class="text-sm text-gray-500">{{ comment.created_at }}</p>
                            </div>
                            <p class="text-gray-700">{{ comment.comment_body }}</p>
                            <hr class="mt-2">
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
